--WEATHER ANALYSIS

--There is a table with daily weather data over the last 6 months of 2020, including the maximum ,minimum , and average temperatures.

--Write a query that gives month , monthly maximum, monthly average temperatures for the six months .

--NOTE | Round the average to the nearest integer





-- Load into Database

CREATE TABLE temperature_records (
record_date VARCHAR(10),
data_type VARCHAR(10),
data_value SMALLINT);
INSERT INTO temperature_records VALUES 
 ('2020-07-01','max','120'), 
 ('2020-07-01','min','77'), 
 ('2020-07-01','avg','80'), 
 ('2020-07-02','max','109'), 
 ('2020-07-02','min','114'), 
 ('2020-07-02','avg','100'), 
 ('2020-07-03','max','120'), 
 ('2020-07-03','min','101'), 
 ('2020-07-03','avg','113'), 
 ('2020-07-04','max','108'), 
 ('2020-07-04','min','118'), 
 ('2020-07-04','avg','103'), 
 ('2020-07-05','max','106'), 
 ('2020-07-05','min','120'), 
 ('2020-07-05','avg','117'), 
 ('2020-07-06','max','113'), 
 ('2020-07-06','min','105'), 
 ('2020-07-06','avg','108'), 
 ('2020-07-07','max','119'), 
 ('2020-07-07','min','105'), 
 ('2020-07-07','avg','107'), 
 ('2020-07-08','max','116'), 
 ('2020-07-08','min','115'), 
 ('2020-07-08','avg','103'), 
 ('2020-07-09','max','114'), 
 ('2020-07-09','min','109'), 
 ('2020-07-09','avg','105'), 
 ('2020-07-10','max','107'), 
 ('2020-07-10','min','115'), 
 ('2020-07-10','avg','104'), 
 ('2020-07-11','max','118'), 
 ('2020-07-11','min','110'), 
 ('2020-07-11','avg','116'), 
 ('2020-07-12','max','117'), 
 ('2020-07-12','min','120'), 
 ('2020-07-12','avg','112'), 
 ('2020-07-13','max','111'), 
 ('2020-07-13','min','101'), 
 ('2020-07-13','avg','108'), 
 ('2020-07-14','max','104'), 
 ('2020-07-14','min','113'), 
 ('2020-07-14','avg','115'), 
 ('2020-07-15','max','107'), 
 ('2020-07-15','min','107'), 
 ('2020-07-15','avg','114'), 
 ('2020-07-16','max','101'), 
 ('2020-07-16','min','105'), 
 ('2020-07-16','avg','113'), 
 ('2020-07-17','max','104'), 
 ('2020-07-17','min','100'), 
 ('2020-07-17','avg','119'), 
 ('2020-07-18','max','120'), 
 ('2020-07-18','min','109'), 
 ('2020-07-18','avg','104'), 
 ('2020-07-19','max','100'), 
 ('2020-07-19','min','113'), 
 ('2020-07-19','avg','112'), 
 ('2020-07-20','max','117'), 
 ('2020-07-20','min','103'), 
 ('2020-07-20','avg','119'), 
 ('2020-07-21','max','112'), 
 ('2020-07-21','min','118'), 
 ('2020-07-21','avg','105'), 
 ('2020-07-22','max','113'), 
 ('2020-07-22','min','110'), 
 ('2020-07-22','avg','108'), 
 ('2020-07-23','max','114'), 
 ('2020-07-23','min','118'), 
 ('2020-07-23','avg','101'), 
 ('2020-07-24','max','117'), 
 ('2020-07-24','min','119'), 
 ('2020-07-24','avg','109'), 
 ('2020-07-25','max','104'), 
 ('2020-07-25','min','115'), 
 ('2020-07-25','avg','113'), 
 ('2020-07-26','max','107'), 
 ('2020-07-26','min','112'), 
 ('2020-07-26','avg','105'), 
 ('2020-07-27','max','117'), 
 ('2020-07-27','min','108'), 
 ('2020-07-27','avg','119'), 
 ('2020-07-28','max','104'), 
 ('2020-07-28','min','104'), 
 ('2020-07-28','avg','105'), 
 ('2020-07-29','max','114'), 
 ('2020-07-29','min','111'), 
 ('2020-07-29','avg','114'), 
 ('2020-07-30','max','106'), 
 ('2020-07-30','min','102'), 
 ('2020-07-30','avg','112'), 
 ('2020-07-31','max','109'), 
 ('2020-07-31','min','105'), 
 ('2020-07-31','avg','103'), 
 ('2020-08-01','max','110'), 
 ('2020-08-01','min','119'), 
 ('2020-08-01','avg','109'), 
 ('2020-08-02','max','103'), 
 ('2020-08-02','min','112'), 
 ('2020-08-02','avg','114'), 
 ('2020-08-03','max','120'), 
 ('2020-08-03','min','111'), 
 ('2020-08-03','avg','106'), 
 ('2020-08-04','max','114'), 
 ('2020-08-04','min','102'), 
 ('2020-08-04','avg','107'), 
 ('2020-08-05','max','119'), 
 ('2020-08-05','min','114'), 
 ('2020-08-05','avg','113'), 
 ('2020-08-06','max','115'), 
 ('2020-08-06','min','109'), 
 ('2020-08-06','avg','109'), 
 ('2020-08-07','max','109'), 
 ('2020-08-07','min','114'), 
 ('2020-08-07','avg','103'), 
 ('2020-08-08','max','100'), 
 ('2020-08-08','min','109'), 
 ('2020-08-08','avg','111'), 
 ('2020-08-09','max','106'), 
 ('2020-08-09','min','111'), 
 ('2020-08-09','avg','112'), 
 ('2020-08-10','max','113'), 
 ('2020-08-10','min','112'), 
 ('2020-08-10','avg','116'), 
 ('2020-08-11','max','112'), 
 ('2020-08-11','min','108'), 
 ('2020-08-11','avg','117'), 
 ('2020-08-12','max','100'), 
 ('2020-08-12','min','116'), 
 ('2020-08-12','avg','111'), 
 ('2020-08-13','max','101'), 
 ('2020-08-13','min','108'), 
 ('2020-08-13','avg','118'), 
 ('2020-08-14','max','108'), 
 ('2020-08-14','min','101'), 
 ('2020-08-14','avg','104'), 
 ('2020-08-15','max','106'), 
 ('2020-08-15','min','103'), 
 ('2020-08-15','avg','114'), 
 ('2020-08-16','max','103'), 
 ('2020-08-16','min','105'), 
 ('2020-08-16','avg','100'), 
 ('2020-08-17','max','114'), 
 ('2020-08-17','min','105'), 
 ('2020-08-17','avg','103'), 
 ('2020-08-18','max','100'), 
 ('2020-08-18','min','113'), 
 ('2020-08-18','avg','120'), 
 ('2020-08-19','max','116'), 
 ('2020-08-19','min','109'), 
 ('2020-08-19','avg','109'), 
 ('2020-08-20','max','106'), 
 ('2020-08-20','min','120'), 
 ('2020-08-20','avg','101'), 
 ('2020-08-21','max','118'), 
 ('2020-08-21','min','102'), 
 ('2020-08-21','avg','119'), 
 ('2020-08-22','max','120'), 
 ('2020-08-22','min','101'), 
 ('2020-08-22','avg','120'), 
 ('2020-08-23','max','112'), 
 ('2020-08-23','min','106'), 
 ('2020-08-23','avg','120'), 
 ('2020-08-24','max','104'), 
 ('2020-08-24','min','109'), 
 ('2020-08-24','avg','109'), 
 ('2020-08-25','max','114'), 
 ('2020-08-25','min','100'), 
 ('2020-08-25','avg','104'), 
 ('2020-08-26','max','118'), 
 ('2020-08-26','min','110'), 
 ('2020-08-26','avg','114'), 
 ('2020-08-27','max','108'), 
 ('2020-08-27','min','103'), 
 ('2020-08-27','avg','111'), 
 ('2020-08-28','max','100'), 
 ('2020-08-28','min','109'), 
 ('2020-08-28','avg','114'), 
 ('2020-08-29','max','103'), 
 ('2020-08-29','min','117'), 
 ('2020-08-29','avg','103'), 
 ('2020-08-30','max','104'), 
 ('2020-08-30','min','110'), 
 ('2020-08-30','avg','112'), 
 ('2020-08-31','max','108'), 
 ('2020-08-31','min','108'), 
 ('2020-08-31','avg','103'), 
 ('2020-09-01','max','109'), 
 ('2020-09-01','min','120'), 
 ('2020-09-01','avg','101'), 
 ('2020-09-02','max','110'), 
 ('2020-09-02','min','119'), 
 ('2020-09-02','avg','120'), 
 ('2020-09-03','max','112'), 
 ('2020-09-03','min','108'), 
 ('2020-09-03','avg','117'), 
 ('2020-09-04','max','120'), 
 ('2020-09-04','min','114'), 
 ('2020-09-04','avg','120'), 
 ('2020-09-05','max','114'), 
 ('2020-09-05','min','103'), 
 ('2020-09-05','avg','106'), 
 ('2020-09-06','max','100'), 
 ('2020-09-06','min','107'), 
 ('2020-09-06','avg','119'), 
 ('2020-09-07','max','105'), 
 ('2020-09-07','min','105'), 
 ('2020-09-07','avg','104'), 
 ('2020-09-08','max','119'), 
 ('2020-09-08','min','108'), 
 ('2020-09-08','avg','120'), 
 ('2020-09-09','max','110'), 
 ('2020-09-09','min','119'), 
 ('2020-09-09','avg','109'), 
 ('2020-09-10','max','114'), 
 ('2020-09-10','min','118'), 
 ('2020-09-10','avg','120'), 
 ('2020-09-11','max','118'), 
 ('2020-09-11','min','118'), 
 ('2020-09-11','avg','104'), 
 ('2020-09-12','max','108'), 
 ('2020-09-12','min','115'), 
 ('2020-09-12','avg','104'), 
 ('2020-09-13','max','110'), 
 ('2020-09-13','min','118'), 
 ('2020-09-13','avg','100'), 
 ('2020-09-14','max','111'), 
 ('2020-09-14','min','111'), 
 ('2020-09-14','avg','117'), 
 ('2020-09-15','max','119'), 
 ('2020-09-15','min','109'), 
 ('2020-09-15','avg','111'), 
 ('2020-09-16','max','107'), 
 ('2020-09-16','min','117'), 
 ('2020-09-16','avg','104'), 
 ('2020-09-17','max','118'), 
 ('2020-09-17','min','101'), 
 ('2020-09-17','avg','118'), 
 ('2020-09-18','max','114'), 
 ('2020-09-18','min','100'), 
 ('2020-09-18','avg','119'), 
 ('2020-09-19','max','111'), 
 ('2020-09-19','min','100'), 
 ('2020-09-19','avg','112'), 
 ('2020-09-20','max','113'), 
 ('2020-09-20','min','104'), 
 ('2020-09-20','avg','116'), 
 ('2020-09-21','max','107'), 
 ('2020-09-21','min','102'), 
 ('2020-09-21','avg','116'), 
 ('2020-09-22','max','110'), 
 ('2020-09-22','min','111'), 
 ('2020-09-22','avg','112'), 
 ('2020-09-23','max','104'), 
 ('2020-09-23','min','111'), 
 ('2020-09-23','avg','117'), 
 ('2020-09-24','max','101'), 
 ('2020-09-24','min','113'), 
 ('2020-09-24','avg','101'), 
 ('2020-09-25','max','110'), 
 ('2020-09-25','min','120'), 
 ('2020-09-25','avg','107'), 
 ('2020-09-26','max','102'), 
 ('2020-09-26','min','116'), 
 ('2020-09-26','avg','117'), 
 ('2020-09-27','max','110'), 
 ('2020-09-27','min','104'), 
 ('2020-09-27','avg','112'), 
 ('2020-09-28','max','115'), 
 ('2020-09-28','min','110'), 
 ('2020-09-28','avg','119'), 
 ('2020-09-29','max','117'), 
 ('2020-09-29','min','107'), 
 ('2020-09-29','avg','103'), 
 ('2020-09-30','max','115'), 
 ('2020-09-30','min','108'), 
 ('2020-09-30','avg','110'), 
 ('2020-10-01','max','119'), 
 ('2020-10-01','min','109'), 
 ('2020-10-01','avg','119'), 
 ('2020-10-02','max','116'), 
 ('2020-10-02','min','102'), 
 ('2020-10-02','avg','100'), 
 ('2020-10-03','max','108'), 
 ('2020-10-03','min','112'), 
 ('2020-10-03','avg','118'), 
 ('2020-10-04','max','107'), 
 ('2020-10-04','min','115'), 
 ('2020-10-04','avg','117'), 
 ('2020-10-05','max','106'), 
 ('2020-10-05','min','110'), 
 ('2020-10-05','avg','106'), 
 ('2020-10-06','max','108'), 
 ('2020-10-06','min','105'), 
 ('2020-10-06','avg','106'), 
 ('2020-10-07','max','119'), 
 ('2020-10-07','min','113'), 
 ('2020-10-07','avg','109'), 
 ('2020-10-08','max','104'), 
 ('2020-10-08','min','120'), 
 ('2020-10-08','avg','101'), 
 ('2020-10-09','max','105'), 
 ('2020-10-09','min','104'), 
 ('2020-10-09','avg','111'), 
 ('2020-10-10','max','105'), 
 ('2020-10-10','min','108'), 
 ('2020-10-10','avg','119'), 
 ('2020-10-11','max','119'), 
 ('2020-10-11','min','103'), 
 ('2020-10-11','avg','120'), 
 ('2020-10-12','max','106'), 
 ('2020-10-12','min','108'), 
 ('2020-10-12','avg','106'), 
 ('2020-10-13','max','101'), 
 ('2020-10-13','min','109'), 
 ('2020-10-13','avg','115'), 
 ('2020-10-14','max','106'), 
 ('2020-10-14','min','109'), 
 ('2020-10-14','avg','118'), 
 ('2020-10-15','max','112'), 
 ('2020-10-15','min','116'), 
 ('2020-10-15','avg','114'), 
 ('2020-10-16','max','114'), 
 ('2020-10-16','min','101'), 
 ('2020-10-16','avg','112'), 
 ('2020-10-17','max','101'), 
 ('2020-10-17','min','114'), 
 ('2020-10-17','avg','116'), 
 ('2020-10-18','max','101'), 
 ('2020-10-18','min','110'), 
 ('2020-10-18','avg','109'), 
 ('2020-10-19','max','109'), 
 ('2020-10-19','min','102'), 
 ('2020-10-19','avg','107'), 
 ('2020-10-20','max','116'), 
 ('2020-10-20','min','105'), 
 ('2020-10-20','avg','114'), 
 ('2020-10-21','max','118'), 
 ('2020-10-21','min','108'), 
 ('2020-10-21','avg','109'), 
 ('2020-10-22','max','112'), 
 ('2020-10-22','min','119'), 
 ('2020-10-22','avg','106'), 
 ('2020-10-23','max','106'), 
 ('2020-10-23','min','107'), 
 ('2020-10-23','avg','104'), 
 ('2020-10-24','max','110'), 
 ('2020-10-24','min','117'), 
 ('2020-10-24','avg','111'), 
 ('2020-10-25','max','101'), 
 ('2020-10-25','min','105'), 
 ('2020-10-25','avg','116'), 
 ('2020-10-26','max','109'), 
 ('2020-10-26','min','108'), 
 ('2020-10-26','avg','120'), 
 ('2020-10-27','max','111'), 
 ('2020-10-27','min','107'), 
 ('2020-10-27','avg','101'), 
 ('2020-10-28','max','104'), 
 ('2020-10-28','min','111'), 
 ('2020-10-28','avg','103'), 
 ('2020-10-29','max','102'), 
 ('2020-10-29','min','110'), 
 ('2020-10-29','avg','117'), 
 ('2020-10-30','max','118'), 
 ('2020-10-30','min','107'), 
 ('2020-10-30','avg','111'), 
 ('2020-10-31','max','118'), 
 ('2020-10-31','min','117'), 
 ('2020-10-31','avg','113'), 
 ('2020-11-01','max','108'), 
 ('2020-11-01','min','120'), 
 ('2020-11-01','avg','112'), 
 ('2020-11-02','max','103'), 
 ('2020-11-02','min','106'), 
 ('2020-11-02','avg','118'), 
 ('2020-11-03','max','117'), 
 ('2020-11-03','min','103'), 
 ('2020-11-03','avg','105'), 
 ('2020-11-04','max','116'), 
 ('2020-11-04','min','120'), 
 ('2020-11-04','avg','106'), 
 ('2020-11-05','max','100'), 
 ('2020-11-05','min','101'), 
 ('2020-11-05','avg','101'), 
 ('2020-11-06','max','109'), 
 ('2020-11-06','min','101'), 
 ('2020-11-06','avg','105'), 
 ('2020-11-07','max','111'), 
 ('2020-11-07','min','107'), 
 ('2020-11-07','avg','117'), 
 ('2020-11-08','max','100'), 
 ('2020-11-08','min','109'), 
 ('2020-11-08','avg','109'), 
 ('2020-11-09','max','109'), 
 ('2020-11-09','min','115'), 
 ('2020-11-09','avg','101'), 
 ('2020-11-10','max','106'), 
 ('2020-11-10','min','112'), 
 ('2020-11-10','avg','103'), 
 ('2020-11-11','max','102'), 
 ('2020-11-11','min','115'), 
 ('2020-11-11','avg','116'), 
 ('2020-11-12','max','119'), 
 ('2020-11-12','min','113'), 
 ('2020-11-12','avg','109'), 
 ('2020-11-13','max','111'), 
 ('2020-11-13','min','106'), 
 ('2020-11-13','avg','119'), 
 ('2020-11-14','max','115'), 
 ('2020-11-14','min','115'), 
 ('2020-11-14','avg','100'), 
 ('2020-11-15','max','119'), 
 ('2020-11-15','min','105'), 
 ('2020-11-15','avg','110'), 
 ('2020-11-16','max','109'), 
 ('2020-11-16','min','118'), 
 ('2020-11-16','avg','116'), 
 ('2020-11-17','max','116'), 
 ('2020-11-17','min','108'), 
 ('2020-11-17','avg','105'), 
 ('2020-11-18','max','115'), 
 ('2020-11-18','min','100'), 
 ('2020-11-18','avg','108'), 
 ('2020-11-19','max','108'), 
 ('2020-11-19','min','118'), 
 ('2020-11-19','avg','103'), 
 ('2020-11-20','max','114'), 
 ('2020-11-20','min','104'), 
 ('2020-11-20','avg','117'), 
 ('2020-11-21','max','102'), 
 ('2020-11-21','min','102'), 
 ('2020-11-21','avg','102'), 
 ('2020-11-22','max','118'), 
 ('2020-11-22','min','115'), 
 ('2020-11-22','avg','115'), 
 ('2020-11-23','max','104'), 
 ('2020-11-23','min','111'), 
 ('2020-11-23','avg','107'), 
 ('2020-11-24','max','101'), 
 ('2020-11-24','min','118'), 
 ('2020-11-24','avg','110'), 
 ('2020-11-25','max','113'), 
 ('2020-11-25','min','108'), 
 ('2020-11-25','avg','108'), 
 ('2020-11-26','max','109'), 
 ('2020-11-26','min','115'), 
 ('2020-11-26','avg','110'), 
 ('2020-11-27','max','113'), 
 ('2020-11-27','min','114'), 
 ('2020-11-27','avg','113'), 
 ('2020-11-28','max','120'), 
 ('2020-11-28','min','100'), 
 ('2020-11-28','avg','116'), 
 ('2020-11-29','max','116'), 
 ('2020-11-29','min','101'), 
 ('2020-11-29','avg','115'), 
 ('2020-11-30','max','120'), 
 ('2020-11-30','min','103'), 
 ('2020-11-30','avg','108'), 
 ('2020-12-01','max','117'), 
 ('2020-12-01','min','118'), 
 ('2020-12-01','avg','107'), 
 ('2020-12-02','max','110'), 
 ('2020-12-02','min','100'), 
 ('2020-12-02','avg','103'), 
 ('2020-12-03','max','104'), 
 ('2020-12-03','min','108'), 
 ('2020-12-03','avg','116'), 
 ('2020-12-04','max','105'), 
 ('2020-12-04','min','117'), 
 ('2020-12-04','avg','111'), 
 ('2020-12-05','max','119'), 
 ('2020-12-05','min','114'), 
 ('2020-12-05','avg','109'), 
 ('2020-12-06','max','112'), 
 ('2020-12-06','min','105'), 
 ('2020-12-06','avg','102'), 
 ('2020-12-07','max','112'), 
 ('2020-12-07','min','103'), 
 ('2020-12-07','avg','118'), 
 ('2020-12-08','max','115'), 
 ('2020-12-08','min','107'), 
 ('2020-12-08','avg','118'), 
 ('2020-12-09','max','109'), 
 ('2020-12-09','min','114'), 
 ('2020-12-09','avg','112'), 
 ('2020-12-10','max','103'), 
 ('2020-12-10','min','117'), 
 ('2020-12-10','avg','118'), 
 ('2020-12-11','max','102'), 
 ('2020-12-11','min','117'), 
 ('2020-12-11','avg','109'), 
 ('2020-12-12','max','109'), 
 ('2020-12-12','min','119'), 
 ('2020-12-12','avg','113'), 
 ('2020-12-13','max','113'), 
 ('2020-12-13','min','116'), 
 ('2020-12-13','avg','101'), 
 ('2020-12-14','max','113'), 
 ('2020-12-14','min','117');
INSERT INTO temperature_records VALUES 
 ('2020-12-14','avg','111'), 
 ('2020-12-15','max','115'), 
 ('2020-12-15','min','120'), 
 ('2020-12-15','avg','118'), 
 ('2020-12-16','max','112'), 
 ('2020-12-16','min','105'), 
 ('2020-12-16','avg','111'), 
 ('2020-12-17','max','116'), 
 ('2020-12-17','min','103'), 
 ('2020-12-17','avg','100'), 
 ('2020-12-18','max','116'), 
 ('2020-12-18','min','117'), 
 ('2020-12-18','avg','102'), 
 ('2020-12-19','max','120'), 
 ('2020-12-19','min','111'), 
 ('2020-12-19','avg','116'), 
 ('2020-12-20','max','103'), 
 ('2020-12-20','min','103'), 
 ('2020-12-20','avg','119'), 
 ('2020-12-21','max','111'), 
 ('2020-12-21','min','106'), 
 ('2020-12-21','avg','114'), 
 ('2020-12-22','max','115'), 
 ('2020-12-22','min','107'), 
 ('2020-12-22','avg','113'), 
 ('2020-12-23','max','111'), 
 ('2020-12-23','min','100'), 
 ('2020-12-23','avg','118'), 
 ('2020-12-24','max','101'), 
 ('2020-12-24','min','113'), 
 ('2020-12-24','avg','101'), 
 ('2020-12-25','max','117'), 
 ('2020-12-25','min','119'), 
 ('2020-12-25','avg','104'), 
 ('2020-12-26','max','110'), 
 ('2020-12-26','min','120'), 
 ('2020-12-26','avg','106'), 
 ('2020-12-27','max','120'), 
 ('2020-12-27','min','120'), 
 ('2020-12-27','avg','108'), 
 ('2020-12-28','max','119'), 
 ('2020-12-28','min','103'), 
 ('2020-12-28','avg','119'), 
 ('2020-12-29','max','114'), 
 ('2020-12-29','min','100'), 
 ('2020-12-29','avg','104'), 
 ('2020-12-30','max','105'), 
 ('2020-12-30','min','107'), 
 ('2020-12-30','avg','118'), 
 ('2020-12-31','max','120'), 
 ('2020-12-31','min','107'), 
 ('2020-12-31','avg','116');

 -- Check if the Table is without any missing value

select record_date,data_type,data_value
from temperature_records;

-- Create CTE and join the tables witha Primary Key

with max AS( 

Select datepart(month,record_date) as month_max,max(data_value) as Max_value
from temperature_records
group by datepart(month,record_date)

),

min as 
(
select datepart(month,record_date) as month_min,min(data_value) as min_value
from temperature_records
where data_type = 'avg'
group by datepart(month,record_date)),

avg as
(
select datepart(month,record_date) as month_avg,round (avg(cast(data_value as float)),0) as avg_value
from temperature_records
group by datepart(month,record_date),data_type)

select month_max,max_value,min_value,avg_value 
from max
JOIN   min ON min.month_min = max.month_max
JOIN   avg ON avg.month_avg = max.month_max;


